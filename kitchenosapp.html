<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <!-- CONFIGURATION CRITIQUE POUR MOBILE : Emp√™che le zoom et force la largeur -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>KitchenOS</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%230f172a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><path d='M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z'/><line x1='6' y1='17' x2='18' y2='17'/></svg>">

    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Reset total pour mobile */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            height: 100dvh; /* Hauteur dynamique pour mobile */
            overflow: hidden; /* Emp√™che le scroll global du body */
            background-color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation; /* Am√©liore la r√©activit√© tactile */
        }
        
        #root {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            background-color: #f1f5f9; /* Fond gris clair derri√®re l'app */
        }

        /* Masquer scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animation */
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: slideIn 0.3s ease-out forwards; }

        /* Emp√™cher le zoom sur input iOS */
        input, select, textarea { font-size: 16px !important; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- SYST√àME D'IC√îNES ---
        const Icon = ({ path, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <g dangerouslySetInnerHTML={{ __html: path }} />
            </svg>
        );

        const ICONS = {
            ChefHat: '<path d="M6 13.87A4 4 0 0 1 7.41 6a5.11 5.11 0 0 1 1.05-1.54 5 5 0 0 1 7.08 0A5.11 5.11 0 0 1 16.59 6 4 4 0 0 1 18 13.87V21H6Z"/><line x1="6" y1="17" x2="18" y2="17"/>',
            Calendar: '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>',
            ShoppingCart: '<circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>',
            Plus: '<line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>',
            Trash2: '<polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/>',
            Check: '<polyline points="20 6 9 17 4 12"/>',
            X: '<line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>',
            Clock: '<circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>',
            Flame: '<path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/>',
            BookOpen: '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',
            ArrowLeft: '<line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/>',
            RefreshCw: '<polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>',
            ChevronRight: '<polyline points="9 18 15 12 9 6"/>',
            Search: '<circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>',
            Download: '<path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/>',
            Pencil: '<path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/>',
            CalendarDays: '<rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/>',
            Minus: '<line x1="5" y1="12" x2="19" y2="12"/>',
            Utensils: '<path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"/><path d="M7 2v20"/><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"/>',
            Timer: '<line x1="10" y1="2" x2="14" y2="2"/><line x1="12" y1="14" x2="15" y2="11"/><circle cx="12" cy="14" r="8"/>',
            Scale: '<path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/>',
            Calculator: '<rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="16" y1="18" x2="16" y2="18"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="8" y1="18" x2="8" y2="18"/>',
            Play: '<polygon points="5 3 19 12 5 21 5 3"/>',
            Pause: '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>',
            RotateCcw: '<path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/>',
            Wind: '<path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/>',
            ArrowRightLeft: '<path d="m16 7 4-4-4-4"/><path d="M20 3H4"/><path d="m8 17-4 4 4 4"/><path d="M4 21h16"/>'
        };

        const Icons = Object.keys(ICONS).reduce((acc, name) => {
            acc[name] = (props) => <Icon path={ICONS[name]} {...props} />;
            return acc;
        }, {});

        const { ChefHat, Calendar, ShoppingCart, Plus, Trash2, Check, X, Clock, Flame, BookOpen, ArrowLeft, RefreshCw, ChevronRight, Search, Download, Pencil, CalendarDays, Minus, Utensils, Timer, Scale, Calculator, Play, Pause, RotateCcw, Wind, ArrowRightLeft } = Icons;

        // --- UI Components ---
        const Button = ({ children, onClick, variant = 'primary', className = '', ...props }) => {
            const variants = {
                primary: "bg-slate-900 text-white shadow-lg shadow-slate-200",
                secondary: "bg-slate-100 text-slate-700 hover:bg-slate-200",
                ghost: "text-slate-500 hover:bg-slate-50 hover:text-slate-900",
                danger: "bg-red-50 text-red-500 hover:bg-red-100",
                outline: "border-2 border-slate-200 text-slate-700 hover:border-slate-900 hover:text-slate-900"
            };
            return <button onClick={onClick} className={`px-4 py-3 rounded-xl font-medium transition-all active:scale-95 flex items-center justify-center gap-2 ${variants[variant]} ${className}`} {...props}>{children}</button>;
        };

        const Input = ({ label, className = '', ...props }) => (
            <div className="w-full">
                {label && <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 ml-1">{label}</label>}
                <input className={`w-full px-4 py-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-slate-900 outline-none transition-all ${className}`} {...props} />
            </div>
        );

        const TextArea = ({ label, className = '', ...props }) => (
            <div className="w-full">
                {label && <label className="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 ml-1">{label}</label>}
                <textarea className={`w-full px-4 py-3 rounded-xl bg-slate-50 border-none focus:ring-2 focus:ring-slate-900 outline-none resize-none ${className}`} {...props} />
            </div>
        );

        // --- Helpers ---
        const getNext15Days = () => {
            const days = [];
            const today = new Date();
            for (let i = 0; i < 15; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                days.push({ 
                    label: date.toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric', month: 'short' }), 
                    shortLabel: date.toLocaleDateString('fr-FR', { weekday: 'short', day: 'numeric' }),
                    key: date.toISOString().split('T')[0],
                    isWeekend: date.getDay() === 0 || date.getDay() === 6
                });
            }
            return days;
        };

        // --- Data ---
        const STARTER_RECIPES = [
            { id: 21, title: 'Lasagne V√©g√© (Courgettes)', prepTime: '25', cookTime: '50', ingredients: 'Feuilles Lasagnes, 3 courgettes, 1 oignon, Ail, Tomates pel√©es, Lait, Beurre, Farine, Mozzarella', steps: "1. Cuire l√©gumes.\n2. Faire b√©chamel.\n3. Monter lasagnes.\n4. Cuire 30min 200¬∞C." },
            { id: 1, title: 'P√¢tes Carbonara', prepTime: '10', cookTime: '15', ingredients: 'Spaghetti, 3 Oeufs, 150g Guanciale, Pecorino, Poivre', steps: "1. Cuire p√¢tes.\n2. Griller guanciale.\n3. M√©langer oeufs/fromage.\n4. Tout m√©langer hors feu." },
            { id: 2, title: 'Salade C√©sar', prepTime: '20', cookTime: '10', ingredients: 'Laitue, Poulet, Cro√ªtons, Parmesan, Sauce C√©sar', steps: "1. Cuire poulet.\n2. Couper laitue.\n3. M√©langer tout." },
            { id: 3, title: 'Chili con Carne', prepTime: '20', cookTime: '45', ingredients: '500g Boeuf hach√©, 400g Haricots rouges, Tomates, Oignon, √âpices', steps: "1. Cuire viande et oignons.\n2. Ajouter tomates/√©pices.\n3. Mijoter.\n4. Ajouter haricots." },
            { id: 4, title: 'Quiche Lorraine', prepTime: '15', cookTime: '40', ingredients: 'P√¢te bris√©e, 200g Lardons, 4 Oeufs, 20cl Cr√®me, Lait, Fromage', steps: "1. P√¢te dans moule.\n2. Lardons sur p√¢te.\n3. Appareil oeufs/cr√®me dessus.\n4. Cuire 40min 180¬∞C." },
            { id: 5, title: 'Curry Poulet Coco', prepTime: '15', cookTime: '25', ingredients: 'Poulet, Lait coco, Curry rouge, Oignon, Riz', steps: "1. Dorer poulet.\n2. Ajouter curry et coco.\n3. Mijoter 15min." },
            { id: 6, title: 'Risotto Champignons', prepTime: '10', cookTime: '30', ingredients: '300g Riz Arborio, 300g Champignons, Vin blanc, Bouillon, Parmesan', steps: "1. Nacrer riz.\n2. Vin blanc.\n3. Bouillon petit √† petit.\n4. Champignons et parmesan √† la fin." },
            { id: 11, title: 'Saumon au Four', prepTime: '5', cookTime: '20', ingredients: 'Saumon, Citron, Aneth, Huile olive', steps: "1. Saumon dans plat.\n2. Assaisonner.\n3. Cuire 20min 180¬∞C." },
            { id: 15, title: 'Burger Maison', prepTime: '20', cookTime: '10', ingredients: 'Pains, Steacks, Cheddar, Tomate, Salade, Sauce', steps: "1. Cuire viande.\n2. Toaster pains.\n3. Monter burger." },
            { id: 16, title: 'Pancakes', prepTime: '10', cookTime: '15', ingredients: '200g Farine, 2 Oeufs, 25cl Lait, Levure, Sucre', steps: "1. M√©langer tout.\n2. Cuire √† la po√™le." }
        ];

        const SUBSTITUTIONS = [
          { id: 1, target: 'Levure chimique', sub: 'Bicarbonate + Jus citron' },
          { id: 2, target: 'Beurre', sub: 'Huile ou Compote pomme' },
          { id: 3, target: 'Oeuf', sub: 'Banane √©cras√©e ou Yaourt' },
          { id: 4, target: 'Cr√®me fra√Æche', sub: 'Yaourt Grec ou Lait+Beurre' },
          { id: 5, target: 'Sucre', sub: 'Miel ou Sirop d\'√©rable' },
          { id: 6, target: 'Chapelure', sub: 'Biscottes ou Cornflakes √©cras√©s' },
          { id: 7, target: 'Vin blanc', sub: 'Bouillon + Vinaigre' },
          { id: 12, target: 'Chocolat', sub: 'Cacao poudre + Beurre + Sucre' },
        ];

        function MealPlanner() {
            const [activeTab, setActiveTab] = useState('recipes');
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [planningDays, setPlanningDays] = useState([]);
            const [recipes, setRecipes] = useState(() => JSON.parse(localStorage.getItem('mp_recipes_v4')) || STARTER_RECIPES);
            const [plan, setPlan] = useState(() => JSON.parse(localStorage.getItem('mp_plan_v4')) || {});
            const [shoppingList, setShoppingList] = useState(() => JSON.parse(localStorage.getItem('mp_list_v4')) || []);
            
            // Timer
            const [timerSeconds, setTimerSeconds] = useState(0);
            const [isTimerRunning, setIsTimerRunning] = useState(false);
            const timerRef = useRef(null);

            // Form
            const [isFormOpen, setIsFormOpen] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [formData, setFormData] = useState({ title: '', prepTime: '', cookTime: '', ingredients: '', steps: '' });
            const [newItemName, setNewItemName] = useState('');

            useEffect(() => setPlanningDays(getNext15Days()), []);
            useEffect(() => localStorage.setItem('mp_recipes_v4', JSON.stringify(recipes)), [recipes]);
            useEffect(() => localStorage.setItem('mp_plan_v4', JSON.stringify(plan)), [plan]);
            useEffect(() => localStorage.setItem('mp_list_v4', JSON.stringify(shoppingList)), [shoppingList]);

            useEffect(() => {
                if (isTimerRunning && timerSeconds > 0) {
                    timerRef.current = setInterval(() => setTimerSeconds(p => p - 1), 1000);
                } else if (timerSeconds === 0) {
                    setIsTimerRunning(false);
                    if (timerRef.current) clearInterval(timerRef.current);
                }
                return () => clearInterval(timerRef.current);
            }, [isTimerRunning, timerSeconds]);

            const formatTime = (s) => `${Math.floor(s / 60)}:${(s % 60).toString().padStart(2, '0')}`;
            
            // Logic
            const handleSaveRecipe = () => {
                if (!formData.title.trim()) return;
                if (editingId) {
                    setRecipes(recipes.map(r => r.id === editingId ? { ...r, ...formData } : r));
                    if (selectedRecipe?.id === editingId) setSelectedRecipe({ ...selectedRecipe, ...formData });
                } else {
                    setRecipes([...recipes, { id: Date.now(), ...formData }]);
                }
                setIsFormOpen(false);
            };

            const generateListFromPlan = () => {
                const newItems = [];
                Object.values(plan).forEach(rid => {
                    const r = recipes.find(rec => rec.id === rid);
                    if (r) r.ingredients.split(',').forEach(i => newItems.push({ id: Date.now() + Math.random(), name: i.trim(), checked: false, quantity: 1 }));
                });
                setShoppingList([...shoppingList, ...newItems]);
                setActiveTab('shopping');
            };

            // Views
            if (selectedRecipe) {
                return (
                    <div className="w-full h-full flex flex-col max-w-md bg-white shadow-2xl animate-in">
                        <div className="flex-none sticky top-0 bg-white/80 backdrop-blur-md p-4 border-b flex items-center gap-4 z-10">
                            <button onClick={() => setSelectedRecipe(null)} className="p-2 hover:bg-slate-100 rounded-full"><ArrowLeft size={24} /></button>
                            <h2 className="font-bold text-lg truncate flex-1">{selectedRecipe.title}</h2>
                            <button onClick={() => { setEditingId(selectedRecipe.id); setFormData(selectedRecipe); setIsFormOpen(true); }} className="p-2 bg-slate-100 rounded-full"><Pencil size={20} /></button>
                        </div>
                        <div className="flex-1 p-6 space-y-8 overflow-y-auto pb-20">
                            <div className="flex gap-4">
                                <div className="flex-1 bg-blue-50 p-4 rounded-2xl flex flex-col items-center text-blue-600"><Clock size={24} /><span className="font-bold">{selectedRecipe.prepTime}m</span></div>
                                <div className="flex-1 bg-orange-50 p-4 rounded-2xl flex flex-col items-center text-orange-600"><Flame size={24} /><span className="font-bold">{selectedRecipe.cookTime}m</span></div>
                            </div>
                            <div><h3 className="font-bold mb-4 flex gap-2"><ShoppingCart size={20} /> Ingr√©dients</h3><ul className="space-y-2">{selectedRecipe.ingredients.split(',').map((i, k) => <li key={k} className="bg-slate-50 p-2 rounded-lg text-sm">‚Ä¢ {i.trim()}</li>)}</ul></div>
                            <div><h3 className="font-bold mb-4 flex gap-2"><BookOpen size={20} /> √âtapes</h3><div className="space-y-4 text-sm text-slate-600 whitespace-pre-line">{selectedRecipe.steps}</div></div>
                        </div>
                        {isFormOpen && (
                            <div className="fixed inset-0 bg-white z-50 flex flex-col p-4 animate-in">
                                <div className="flex justify-between mb-4"><h3 className="font-bold text-xl">√âdition</h3><button onClick={() => setIsFormOpen(false)}><X /></button></div>
                                <div className="space-y-4 flex-1 overflow-y-auto">
                                    <Input label="Titre" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} />
                                    <div className="flex gap-2"><Input label="Pr√©pa" type="number" value={formData.prepTime} onChange={e => setFormData({...formData, prepTime: e.target.value})} /><Input label="Cuisson" type="number" value={formData.cookTime} onChange={e => setFormData({...formData, cookTime: e.target.value})} /></div>
                                    <TextArea label="Ingr√©dients" value={formData.ingredients} onChange={e => setFormData({...formData, ingredients: e.target.value})} />
                                    <TextArea label="√âtapes" className="h-32" value={formData.steps} onChange={e => setFormData({...formData, steps: e.target.value})} />
                                </div>
                                <Button onClick={handleSaveRecipe} className="mt-4">Sauvegarder</Button>
                            </div>
                        )}
                    </div>
                );
            }

            return (
                <div className="w-full h-full flex flex-col max-w-md bg-white shadow-2xl relative">
                    <header className="flex-none px-6 pt-8 pb-4 sticky top-0 bg-white z-10 flex justify-between items-center">
                        <div className="flex items-center gap-2"><div className="w-8 h-8 bg-slate-900 rounded-lg flex items-center justify-center"><ChefHat size={18} className="text-white"/></div><h1 className="font-bold">KITCHEN<span className="font-light">OS</span></h1></div>
                        {isTimerRunning && activeTab !== 'tools' && <div onClick={() => setActiveTab('tools')} className="bg-slate-900 text-white px-3 py-1 rounded-full text-xs font-mono font-bold animate-pulse cursor-pointer">{formatTime(timerSeconds)}</div>}
                    </header>

                    <main className="px-6 py-4 flex-1 overflow-y-auto">
                        {activeTab === 'recipes' && (
                            <div className="space-y-4 pb-24">
                                <div className="flex justify-between"><h2 className="text-2xl font-bold">Recettes</h2><Button onClick={() => {setEditingId(null); setFormData({title:'', prepTime:'', cookTime:'', ingredients:'', steps:''}); setIsFormOpen(true);}} className="rounded-full w-12 h-12 p-0"><Plus /></Button></div>
                                <div className="relative"><Search className="absolute left-4 top-3.5 text-slate-400" size={20}/><input className="w-full pl-12 pr-4 py-3 rounded-xl bg-slate-100 outline-none" placeholder="Rechercher..." value={searchTerm} onChange={e => setSearchTerm(e.target.value)} /></div>
                                <div className="space-y-3">
                                    {recipes.filter(r => r.title.toLowerCase().includes(searchTerm.toLowerCase())).map(r => (
                                        <div key={r.id} onClick={() => setSelectedRecipe(r)} className="bg-white p-4 rounded-2xl border flex justify-between items-center cursor-pointer active:scale-95 transition-all">
                                            <div><h3 className="font-bold">{r.title}</h3><div className="text-xs text-slate-500 mt-1 flex gap-3"><span>‚è± {r.prepTime}m</span><span>üî• {r.cookTime}m</span></div></div>
                                            <ChevronRight className="text-slate-300" />
                                        </div>
                                    ))}
                                </div>
                                {isFormOpen && (
                                    <div className="fixed inset-0 bg-white z-50 flex flex-col p-4 animate-in">
                                        <div className="flex justify-between mb-4"><h3 className="font-bold text-xl">Nouvelle Recette</h3><button onClick={() => setIsFormOpen(false)}><X /></button></div>
                                        <div className="space-y-4 flex-1 overflow-y-auto">
                                            <Input label="Titre" value={formData.title} onChange={e => setFormData({...formData, title: e.target.value})} />
                                            <div className="flex gap-2"><Input label="Pr√©pa" type="number" value={formData.prepTime} onChange={e => setFormData({...formData, prepTime: e.target.value})} /><Input label="Cuisson" type="number" value={formData.cookTime} onChange={e => setFormData({...formData, cookTime: e.target.value})} /></div>
                                            <TextArea label="Ingr√©dients" value={formData.ingredients} onChange={e => setFormData({...formData, ingredients: e.target.value})} />
                                            <TextArea label="√âtapes" className="h-32" value={formData.steps} onChange={e => setFormData({...formData, steps: e.target.value})} />
                                        </div>
                                        <Button onClick={handleSaveRecipe} className="mt-4">Enregistrer</Button>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeTab === 'planner' && (
                            <div className="space-y-4 pb-24">
                                <h2 className="text-2xl font-bold flex gap-2"><CalendarDays /> Planning</h2>
                                {planningDays.map((d, i) => (
                                    <div key={d.key} className={`flex items-center gap-4 p-3 rounded-xl border ${d.isWeekend ? 'bg-slate-50' : 'bg-white'}`}>
                                        <div className="w-10 text-center border-r pr-3"><div className="font-bold text-sm">{d.shortLabel.split(' ')[0]}</div><div className="text-xs">{d.shortLabel.split(' ')[1]}</div></div>
                                        <select className="flex-1 bg-transparent outline-none truncate" value={plan[d.key] || ''} onChange={e => setPlan({...plan, [d.key]: parseInt(e.target.value)})}>
                                            <option value="">Choisir...</option>
                                            {recipes.map(r => <option key={r.id} value={r.id}>{r.title}</option>)}
                                        </select>
                                    </div>
                                ))}
                                <Button variant="secondary" className="w-full mt-4" onClick={generateListFromPlan}><RefreshCw size={18}/> G√©n√©rer Liste</Button>
                            </div>
                        )}

                        {activeTab === 'shopping' && (
                            <div className="space-y-4 pb-24">
                                <div className="flex justify-between"><h2 className="text-2xl font-bold">Courses</h2><button onClick={() => setShoppingList(shoppingList.filter(i => !i.checked))} className="text-xs font-bold text-red-500 bg-red-50 px-3 py-2 rounded-lg">NETTOYER</button></div>
                                <div className="flex gap-2"><Input placeholder="Ajouter..." value={newItemName} onChange={e => setNewItemName(e.target.value)} /><Button onClick={() => {if(newItemName) setShoppingList([...shoppingList, {id:Date.now(), name:newItemName, checked:false, quantity:1}]); setNewItemName('');}}><Plus /></Button></div>
                                <div className="space-y-2">
                                    {shoppingList.map(item => (
                                        <div key={item.id} onClick={() => setShoppingList(shoppingList.map(i => i.id === item.id ? {...i, checked: !i.checked} : i))} className={`flex items-center gap-3 p-4 rounded-xl border transition-all ${item.checked ? 'bg-slate-50 opacity-50' : 'bg-white'}`}>
                                            <div className={`w-6 h-6 rounded-full border-2 flex items-center justify-center ${item.checked ? 'bg-slate-900 border-slate-900' : 'border-slate-300'}`}>{item.checked && <Check size={14} className="text-white"/>}</div>
                                            <span className={`flex-1 font-medium ${item.checked ? 'line-through' : ''}`}>{item.name}</span>
                                            <div className="flex items-center gap-2 bg-slate-100 rounded p-1" onClick={e => e.stopPropagation()}>
                                                <button onClick={() => setShoppingList(shoppingList.map(i => i.id === item.id ? {...i, quantity: Math.max(1, i.quantity - 1)} : i))} className="w-6 h-6 bg-white rounded shadow-sm flex items-center justify-center"><Minus size={12}/></button>
                                                <span className="text-xs font-bold w-4 text-center">{item.quantity}</span>
                                                <button onClick={() => setShoppingList(shoppingList.map(i => i.id === item.id ? {...i, quantity: i.quantity + 1} : i))} className="w-6 h-6 bg-white rounded shadow-sm flex items-center justify-center"><Plus size={12}/></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'tools' && (
                            <div className="space-y-8 pb-24">
                                <h2 className="text-2xl font-bold flex gap-2"><Utensils /> Outils</h2>
                                
                                {/* Minuteur */}
                                <div className="bg-slate-900 text-white p-6 rounded-2xl shadow-xl text-center relative overflow-hidden">
                                    <Timer size={100} className="absolute top-0 right-0 opacity-10" />
                                    <div className="text-6xl font-mono font-bold mb-6">{formatTime(timerSeconds)}</div>
                                    <div className="flex gap-2 justify-center mb-4">
                                        <Button onClick={() => setIsTimerRunning(!isTimerRunning)} className={isTimerRunning ? "bg-orange-500" : "bg-white text-slate-900"}>{isTimerRunning ? <Pause /> : <Play />}</Button>
                                        <Button onClick={() => {setIsTimerRunning(false); setTimerSeconds(0);}} className="bg-slate-700"><RotateCcw /></Button>
                                    </div>
                                    <div className="flex gap-2 justify-center text-xs font-bold"><button onClick={() => setTimerSeconds(t => t + 60)} className="bg-slate-800 px-3 py-1 rounded">+1m</button><button onClick={() => setTimerSeconds(t => t + 300)} className="bg-slate-800 px-3 py-1 rounded">+5m</button><button onClick={() => setTimerSeconds(t => t + 600)} className="bg-slate-800 px-3 py-1 rounded">+10m</button></div>
                                </div>

                                {/* Air Fryer */}
                                <div className="bg-orange-50 border border-orange-100 p-6 rounded-2xl">
                                    <h3 className="font-bold text-orange-600 mb-4 flex gap-2"><Wind size={16}/> Four ‚ûî Air Fryer</h3>
                                    <div className="flex gap-2 items-center">
                                        <div className="flex-1"><label className="text-xs font-bold text-orange-400">Four ¬∞C</label><input type="number" id="ovenT" className="w-full p-2 rounded font-bold text-orange-900" placeholder="200" onChange={e => {
                                            const t = parseFloat(e.target.value); document.getElementById('afT').innerText = t ? Math.round(t - 20) + ' ¬∞C' : '-';
                                        }}/></div>
                                        <ArrowRightLeft className="text-orange-300" />
                                        <div className="flex-1"><label className="text-xs font-bold text-orange-400">Air Fryer</label><div id="afT" className="w-full p-2 bg-orange-100 rounded font-bold text-orange-900 h-10 flex items-center">-</div></div>
                                    </div>
                                    <div className="flex gap-2 items-center mt-2">
                                        <div className="flex-1"><label className="text-xs font-bold text-orange-400">Temps</label><input type="number" id="ovenTime" className="w-full p-2 rounded font-bold text-orange-900" placeholder="30" onChange={e => {
                                            const t = parseFloat(e.target.value); document.getElementById('afTime').innerText = t ? Math.round(t * 0.8) + ' min' : '-';
                                        }}/></div>
                                        <ArrowRightLeft className="text-orange-300" />
                                        <div className="flex-1"><label className="text-xs font-bold text-orange-400">Temps</label><div id="afTime" className="w-full p-2 bg-orange-100 rounded font-bold text-orange-900 h-10 flex items-center">-</div></div>
                                    </div>
                                </div>

                                {/* Substitutions */}
                                <div className="bg-white border p-6 rounded-2xl">
                                    <h3 className="font-bold text-slate-400 mb-4 flex gap-2"><ArrowRightLeft size={16}/> SOS Substitutions</h3>
                                    <Input placeholder="Chercher (ex: oeuf, beurre)..." onChange={e => {
                                        const val = e.target.value.toLowerCase();
                                        const els = document.querySelectorAll('.sub-item');
                                        els.forEach(el => el.style.display = el.innerText.toLowerCase().includes(val) ? 'block' : 'none');
                                    }} className="mb-2" />
                                    <div className="max-h-40 overflow-y-auto space-y-2">
                                        {SUBSTITUTIONS.map(s => (
                                            <div key={s.id} className="sub-item bg-slate-50 p-2 rounded text-sm">
                                                <span className="font-bold">{s.target}</span> ‚ûî {s.sub}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    <nav className="flex-none bg-white border-t px-6 py-4 flex justify-between items-center sticky bottom-0 z-20 pb-8">
                        {['recipes', 'planner', 'shopping', 'tools'].map(t => (
                            <button key={t} onClick={() => setActiveTab(t)} className={`flex flex-col items-center gap-1 ${activeTab === t ? 'text-slate-900' : 'text-slate-400'}`}>
                                {t === 'recipes' && <ChefHat size={24} strokeWidth={activeTab === t ? 2.5 : 2} />}
                                {t === 'planner' && <Calendar size={24} strokeWidth={activeTab === t ? 2.5 : 2} />}
                                {t === 'shopping' && <ShoppingCart size={24} strokeWidth={activeTab === t ? 2.5 : 2} />}
                                {t === 'tools' && <Utensils size={24} strokeWidth={activeTab === t ? 2.5 : 2} />}
                                <span className="text-[10px] font-bold uppercase">{t === 'recipes' ? 'Recettes' : t === 'planner' ? 'Planning' : t === 'shopping' ? 'Courses' : 'Outils'}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MealPlanner />);
    </script>
</body>
</html>